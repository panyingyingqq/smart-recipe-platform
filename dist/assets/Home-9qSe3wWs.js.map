{"version":3,"file":"Home-9qSe3wWs.js","sources":["../../src/pages/Home.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { supabase } from '../supabase/client';\nimport { Recipe } from '../types';\nimport { Dices } from 'lucide-react';\nimport { motion } from 'framer-motion';\nimport { useRecipeStore } from '../stores/recipeStore';\n\nconst Home: React.FC = () => {\n  const [loading, setLoading] = useState(false);\n  const [recipeIds, setRecipeIds] = useState<string[]>([]);\n  const { openRecipe } = useRecipeStore();\n\n  React.useEffect(() => {\n    const fetchIds = async () => {\n      const { data } = await supabase\n        .from('recipes')\n        .select('id')\n        .eq('is_public', true);\n      if (data) {\n        setRecipeIds(data.map(d => d.id));\n      }\n    };\n    fetchIds();\n  }, []);\n\n  const handleRandomize = async () => {\n    setLoading(true);\n    try {\n      let currentIds = recipeIds;\n      \n      // If IDs haven't loaded yet, fetch them\n      if (currentIds.length === 0) {\n        const { data, error } = await supabase\n          .from('recipes')\n          .select('id')\n          .eq('is_public', true);\n          \n        if (error) throw error;\n        if (data) {\n          currentIds = data.map(d => d.id);\n          setRecipeIds(currentIds);\n        }\n      }\n\n      if (currentIds.length === 0) {\n        alert('暂无食谱数据');\n        return;\n      }\n\n      const randomIndex = Math.floor(Math.random() * currentIds.length);\n      const randomId = currentIds[randomIndex];\n\n      const { data: recipeData, error: recipeError } = await supabase\n        .from('recipes')\n        .select(`\n          *,\n          ingredients:recipe_ingredients(\n            amount, unit, notes, name, hint,\n            ingredient:ingredients(name, image_url, category)\n          ),\n          steps:recipe_steps(*)\n        `)\n        .eq('id', randomId)\n        .single();\n\n      if (recipeError) throw recipeError;\n\n      openRecipe(recipeData as Recipe);\n    } catch (error) {\n      console.error('Error fetching random recipe:', error);\n      alert('获取食谱失败，请稍后重试');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-8\">\n      <section className=\"text-center py-12 md:py-20 relative z-10\">\n        <h1 className=\"text-4xl md:text-6xl font-bold text-kawaii-text-main mb-6 font-cute drop-shadow-sm tracking-wide\">\n          今天吃什么？\n        </h1>\n        <p className=\"text-xl text-kawaii-text-sub mb-10 max-w-2xl mx-auto font-cute\">\n          不知道做什么菜？让我们的智能食谱决策器帮你决定！\n        </p>\n        <button\n          onClick={handleRandomize}\n          disabled={loading}\n          className=\"bg-kawaii-pink-500 text-white px-10 py-5 rounded-full text-2xl font-bold shadow-sticker hover:shadow-xl hover:scale-105 active:scale-95 transition-all transform flex items-center gap-4 mx-auto disabled:opacity-70 disabled:cursor-not-allowed font-cute border-4 border-white ring-4 ring-kawaii-pink-100\"\n        >\n          <motion.div\n            animate={loading ? { rotate: 360 } : {}}\n            transition={loading ? { repeat: Infinity, duration: 0.3, ease: \"linear\" } : {}}\n          >\n            <Dices className=\"w-10 h-10\" />\n          </motion.div>\n          {loading ? '正在挑选...' : '摇一摇'}\n        </button>\n      </section>\n    </div>\n  );\n};\n\nexport default Home;\n"],"names":["Home","loading","setLoading","useState","recipeIds","setRecipeIds","openRecipe","useRecipeStore","React","useEffect","data","supabase","from","select","eq","map","d","id","fetchIds","handleRandomize","currentIds","length","error","alert","randomIndex","Math","floor","random","randomId","recipeData","recipeError","single","console","jsx","jsxs","motion","rotate","repeat","Infinity","duration","ease","Dices"],"mappings":"8KAOA,MAAMA,EAAiBA,IAAM,CAC3B,KAAM,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAS,EAAK,EACtC,CAACC,EAAWC,CAAY,EAAIF,EAAAA,SAAmB,CAAA,CAAE,EACjD,CAAEG,WAAAA,CAAAA,EAAeC,EAAAA,EAEvBC,EAAMC,UAAU,IAAM,EACH,SAAY,CAC3B,KAAM,CAAEC,KAAAA,CAAAA,EAAS,MAAMC,EACpBC,KAAK,SAAS,EACdC,OAAO,IAAI,EACXC,GAAG,YAAa,EAAI,EACnBJ,GACFL,EAAaK,EAAKK,IAAIC,GAAKA,EAAEC,EAAE,CAAC,CAEpC,GACAC,CACF,EAAG,CAAA,CAAE,EAEL,MAAMC,EAAkB,SAAY,CAClCjB,EAAW,EAAI,EACf,GAAI,CACF,IAAIkB,EAAahB,EAGjB,GAAIgB,EAAWC,SAAW,EAAG,CAC3B,KAAM,CAAEX,KAAAA,EAAMY,MAAAA,CAAAA,EAAU,MAAMX,EAC3BC,KAAK,SAAS,EACdC,OAAO,IAAI,EACXC,GAAG,YAAa,EAAI,EAEvB,GAAIQ,EAAO,MAAMA,EACbZ,IACFU,EAAaV,EAAKK,IAAIC,GAAKA,EAAEC,EAAE,EAC/BZ,EAAae,CAAU,EAE3B,CAEA,GAAIA,EAAWC,SAAW,EAAG,CAC3BE,MAAM,QAAQ,EACd,MACF,CAEA,MAAMC,EAAcC,KAAKC,MAAMD,KAAKE,OAAAA,EAAWP,EAAWC,MAAM,EAC1DO,EAAWR,EAAWI,CAAW,EAEjC,CAAEd,KAAMmB,EAAYP,MAAOQ,CAAAA,EAAgB,MAAMnB,EACpDC,KAAK,SAAS,EACdC,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAOP,EACAC,GAAG,KAAMc,CAAQ,EACjBG,OAAAA,EAEH,GAAID,EAAa,MAAMA,EAEvBxB,EAAWuB,CAAoB,CACjC,OAASP,EAAO,CACdU,QAAQV,MAAM,gCAAiCA,CAAK,EACpDC,MAAM,cAAc,CACtB,QAAA,CACErB,EAAW,EAAK,CAClB,CACF,EAEA,OACE+B,EAAAA,IAAC,MAAA,CAAG,4BAAA,KAAA,8BAAA,IAAA,0BAAA,MAAA,4BAAA,KAAA,2BAAA,2BAAA,8BAAA,mDAAC,UAAU,YACb,SAAAC,EAAAA,KAAC,UAAA,CAAO,4BAAA,KAAA,8BAAA,IAAA,0BAAA,KAAA,4BAAA,KAAA,2BAAA,2BAAA,8BAAA,mDAAC,UAAU,2CACjB,SAAA,CAAAD,MAAC,KAAA,CAAE,4BAAA,KAAA,8BAAA,IAAA,0BAAA,KAAA,4BAAA,KAAA,2BAAA,2BAAA,8BAAA,mQAAC,UAAU,mGAAkG,SAAA,SAEhH,QACC,IAAA,CAAC,4BAAA,KAAA,8BAAA,IAAA,0BAAA,KAAA,4BAAA,KAAA,2BAAA,2BAAA,8BAAA,oaAAC,UAAU,iEAAgE,SAAA,2BAE7E,SACC,SAAA,CAAM,4BAAA,KAAA,8BAAA,IAAA,0BAAA,KAAA,4BAAA,KAAA,2BAAA,2BAAA,8BAAA,mDACL,QAASd,EACT,SAAUlB,EACV,UAAU,+SAEV,SAAA,CAAAgC,EAAAA,IAACE,EAAO,IAAP,CACC,QAASlC,EAAU,CAAEmC,OAAQ,GAAA,EAAQ,CAAA,EACrC,WAAYnC,EAAU,CAAEoC,OAAQC,IAAUC,SAAU,GAAKC,KAAM,QAAA,EAAa,CAAA,EAE5E,eAACC,EAAA,CAAM,UAAU,YAAW,EAC9B,EACCxC,EAAU,UAAY,KAAA,CAAA,CACzB,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}